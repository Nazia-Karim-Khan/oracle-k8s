Install cert-manager:
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.14.4/cert-manager.yaml

kubectl apply -f rbac/cluster-role-binding.yaml

kubectl apply -f oracle-database-operator.yaml

kubectl apply -f rbac/node-rbac.yaml

Generate Secret:
kubectl create secret generic db-admin-secret --from-literal=oracle_pwd=MyameisNazia1# -n oracle-sidb

Log into Oracle Container Registry and accept the license agreement for the Database image; then generate auth token:
kubectl create secret docker-registry oracle-container-registry-secret --docker-server=container-registry.oracle.com --docker-username='nazia.karim@brainstation-23.com' --docker-password='e+_wjIoet#i83kA4mF9' --docker-email='nazia.karim@brainstation-23.com' -n oracle-sidb

Create storage class:
kubectl apply -f storage-class.yaml 

Create single instance database:
kubectl apply -f singleinstancedatabase_create.yaml

Chech status:
kubectl get singleinstancedatabase sidb-sample -o "jsonpath={.status.status}" -n oracle-sidb 

Install sqlplus:
https://www.geeksforgeeks.org/how-to-install-sqlplus-on-linux/

Connect to database:
kubectl get singleinstancedatabase sidb-sample -o "jsonpath={.status.connectString}" -n oracle-sidb
sqlplus sys/MyameisNazia1#@<connection_string>>/ORCL1 as sysdba

CREATE TABLE employees (
    emp_id NUMBER PRIMARY KEY,
    emp_name VARCHAR2(100),
    emp_salary NUMBER(10, 2),
    hire_date DATE
);

INSERT INTO employees (emp_id, emp_name, emp_salary, hire_date) 
VALUES (1, 'John Doe', 55000, TO_DATE('2020-06-15', 'YYYY-MM-DD'));

INSERT INTO employees (emp_id, emp_name, emp_salary, hire_date) 
VALUES (2, 'Jane Smith', 60000, TO_DATE('2019-05-10', 'YYYY-MM-DD'));

INSERT INTO employees (emp_id, emp_name, emp_salary, hire_date) 
VALUES (3, 'Alice Johnson', 52000, TO_DATE('2021-08-25', 'YYYY-MM-DD'));

INSERT INTO employees (emp_id, emp_name, emp_salary, hire_date) 
VALUES (4, 'Bob Brown', 58000, TO_DATE('2018-11-05', 'YYYY-MM-DD'));

INSERT INTO employees (emp_id, emp_name, emp_salary, hire_date) 
VALUES (5, 'Charlie Davis', 62000, TO_DATE('2022-03-12', 'YYYY-MM-DD'));

SELECT * FROM employees;

commit


Update Reclaim Policy:
kubectl patch pv pvc-a4ac2535-3782-4968-81a3-1a98407c12c6 -p '{"spec":{"persistentVolumeReclaimPolicy":"Retain"}}'


Clone a Database: 
kubectl apply -f singleinstancedatabase_clone.yaml


Ref: https://github.com/oracle/oracle-database-operator, https://github.com/oracle/oracle-database-operator/blob/main/docs/sidb/README.md#singleinstancedatabase-resource


mkdir -p /opt/oracle/backup/
chmod 777 /opt/oracle/backup/
rman target /

BACKUP DATABASE PLUS ARCHIVELOG;

BACKUP CURRENT CONTROLFILE FORMAT '/opt/oracle/backup/controlfile.bkp';

ls -lh /opt/oracle/backup/ 

kubectl cp sidb-sample-19hhb:/opt/oracle/backup ./local_backup -n oracle-sidb

kubectl cp ./local_backup sidb-sample-zaouh:/opt/oracle/backup -n oracle-sidb

SHUTDOWN IMMEDIATE;



rman target /

RESTORE CONTROLFILE FROM '/opt/oracle/backup/controlfile.bkp';
ALTER DATABASE MOUNT;
RESTORE DATABASE;
RECOVER DATABASE;
